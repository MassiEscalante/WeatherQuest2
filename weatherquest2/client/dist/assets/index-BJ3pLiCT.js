(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const I=document.getElementById("search-form"),h=document.getElementById("search-input"),l=document.querySelector("#today"),a=document.querySelector("#forecast"),d=document.getElementById("history"),y=document.getElementById("search-title"),E=document.getElementById("weather-img"),f=document.getElementById("temp"),g=document.getElementById("wind"),w=document.getElementById("humidity"),m=async e=>{try{const n=await(await fetch("/api/weather/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cityName:e})})).json();console.log("weatherData:",n);const c={city:n.city.name,date:new Date(n.list[0].dt*1e3).toLocaleDateString(),icon:n.list[0].weather[0].icon,iconDescription:n.list[0].weather[0].description,tempF:(n.list[0].main.temp-273.15)*9/5+32,windSpeed:n.list[0].wind.speed,humidity:n.list[0].main.humidity},r=n.list.slice(1,6).map(o=>({date:new Date(o.dt*1e3).toLocaleDateString(),icon:o.weather[0].icon,iconDescription:o.weather[0].description,tempF:(o.main.temp-273.15)*9/5+32,windSpeed:o.wind.speed,humidity:o.main.humidity}));v(c),D(r)}catch(t){console.error("Error fetching weather:",t)}},S=async()=>{try{return await(await fetch("/api/weather/history",{method:"GET",headers:{"Content-Type":"application/json"}})).json()}catch(e){console.error("Error fetching search history:",e)}},F=async e=>{try{await fetch(`/api/weather/history/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),p()}catch(t){console.error("Error deleting city:",t)}},v=e=>{const{city:t,date:n,icon:c,iconDescription:r,tempF:o,windSpeed:i,humidity:s}=e;y.textContent=`${t} (${n})`,E.setAttribute("src",`https://openweathermap.org/img/w/${c}.png`),E.setAttribute("alt",r),f.textContent=`Temp: ${o.toFixed(2)}°F`,g.textContent=`Wind: ${i} MPH`,w.textContent=`Humidity: ${s}%`,l&&(l.innerHTML="",l.append(y,f,g,w))},D=e=>{const t=document.createElement("div"),n=document.createElement("h4");t.setAttribute("class","col-12"),n.textContent="5-Day Forecast:",t.append(n),a&&(a.innerHTML="",a.append(t)),e.forEach(c=>{H(c)})},H=e=>{const{date:t,icon:n,iconDescription:c,tempF:r,windSpeed:o,humidity:i}=e,{col:s,cardTitle:b,weatherIcon:u,tempEl:L,windEl:C,humidityEl:x}=T();b.textContent=t,u.setAttribute("src",`https://openweathermap.org/img/w/${n}.png`),u.setAttribute("alt",c),L.textContent=`Temp: ${r.toFixed(2)} °F`,C.textContent=`Wind: ${o} MPH`,x.textContent=`Humidity: ${i}%`,a==null||a.append(s)},T=()=>{const e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),c=document.createElement("h5"),r=document.createElement("img"),o=document.createElement("p"),i=document.createElement("p"),s=document.createElement("p");return e.append(t),t.append(n),n.append(c,r,o,i,s),e.classList.add("col-auto"),t.classList.add("forecast-card","card","text-white","bg-primary","h-100"),n.classList.add("card-body","p-2"),c.classList.add("card-title"),o.classList.add("card-text"),i.classList.add("card-text"),s.classList.add("card-text"),{col:e,cardTitle:c,weatherIcon:r,tempEl:o,windEl:i,humidityEl:s}},B=e=>{e.preventDefault();const t=h.value.trim();if(!t){alert("City cannot be blank");return}m(t).then(()=>{p()}),h.value=""},$=e=>{if(e.target.matches(".history-btn")){const t=e.target.textContent;t&&m(t)}},p=()=>{S().then(e=>{A(e)})},A=e=>{if(!e||!e.length){d.innerHTML='<p class="text-center">No Previous Search History</p>';return}d.innerHTML="",e.forEach(t=>{const n=P(t);d.append(n)})},P=e=>{const t=document.createElement("div"),n=O(e.name),c=M(e.id);return t.classList.add("display-flex","gap-2","col-12","m-1"),t.append(n,c),t},O=e=>{const t=document.createElement("button");return t.textContent=e,t.setAttribute("type","button"),t.setAttribute("aria-controls","today forecast"),t.classList.add("history-btn","btn","btn-secondary","col-10"),t.addEventListener("click",()=>{m(e)}),t},M=e=>{const t=document.createElement("button");return t.classList.add("fas","fa-trash-alt","delete-city","btn","btn-danger","col-2"),t.addEventListener("click",n=>{n.stopPropagation(),F(e)}),t};I.addEventListener("submit",B);d.addEventListener("click",$);p();
